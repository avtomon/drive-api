$(function(){function a(a,b,c){let d={},f=this;if($.ajax({async:!1,url:"config.js",dataType:"script",scriptCharset:"UTF-8",success:function(a){eval(a),f.config=c?$.extend(d,c):d},error:function(a,b){throw new Error("\u041D\u0435 \u0443\u0434\u0430\u043B\u043E\u0441\u044C \u043F\u043E\u043B\u0443\u0447\u0438\u0442\u044C \u043A\u043E\u043D\u0444\u0438\u0433\u0443\u0440\u0430\u0446\u0438\u043E\u043D\u043D\u044B\u0439 \u0444\u0430\u0439\u043B. \u041E\u0448\u0438\u0431\u043A\u0430: "+b)}}),b=b&&"object"==typeof b?b:{},this.folders=this.config.FOLDERS&&"object"==typeof this.config.FOLDERS?$.extend(this.config.FOLDERS,b):b,this.checkConfig(),a&&this.folders[a])this.label=a,this.folder_id=this.folders[a];else throw new Error("\u041E\u0431\u044A\u0435\u043A\u0442 \u043D\u0435 \u043F\u043E\u0434\u0434\u0435\u0440\u0436\u0438\u0432\u0430\u0435\u0442 \u0440\u0430\u0431\u043E\u0442\u0443 \u0441 \u043F\u0430\u043F\u043A\u043E\u0439 "+a+" \u0438\u043B\u0438 \u043C\u0435\u0442\u043A\u0430 \u043F\u0430\u043F\u043A\u0438 \u043D\u0435 \u0437\u0430\u0434\u0430\u043D\u0430");this.setToken()}var b=Math.pow,d=Math.ceil;let c=[];a.prototype.checkConfig=function(){let a=this.config;if(a&&"object"==typeof a){if(a.FOLDERS===void 0)throw new Error("\u0421\u043F\u0438\u0441\u043E\u043A \u043F\u0430\u043F\u043E\u043A \u0441 \u0444\u0430\u0439\u043B\u0430\u043C\u0438 \u043F\u0443\u0441\u0442");if(void 0===a.DRIVE_FILE_INFO)throw new Error("\u0421\u043F\u0438\u0441\u043E\u043A \u043F\u043E\u043B\u0435\u0439 \u0438\u043D\u0444\u043E\u0440\u043C\u0430\u0446\u0438\u0438 \u043E \u0444\u0430\u0439\u043B\u0435 \u043F\u0443\u0441\u0442");if(void 0===a.BOUNDARY)throw new Error("\u0417\u043D\u0430\u0447\u0435\u043D\u0438\u0435 \u0440\u0430\u0437\u0434\u0435\u043B\u0438\u0442\u0435\u043B\u044F \u0442\u0435\u043B\u0430 multipart-\u0437\u0430\u043F\u0440\u043E\u0441\u0430 \u043E\u0442\u0441\u0443\u0442\u0441\u0442\u0432\u0443\u0435\u0442");if(void 0===a.CHUNK_SIZE)throw new Error("\u0412 \u043A\u043E\u043D\u0444\u0438\u0433\u0443\u0440\u0430\u0446\u0438\u0438 \u043E\u0442\u0441\u0443\u0442\u0441\u0442\u0432\u0443\u0435\u0442 \u0437\u043D\u0430\u0447\u0435\u043D\u0438\u0435 \u0440\u0430\u0437\u043C\u0435\u0440\u0430 \u043A\u0443\u0441\u043A\u0430 \u0434\u0430\u043D\u043D\u044B\u0445 \u0434\u043B\u044F resumable-\u0437\u0430\u043F\u0438\u0441\u0438")}else throw new Error("\u041A\u043E\u043D\u0444\u0438\u0433\u0443\u0440\u0430\u0446\u0438\u044F \u043D\u0435 \u0438\u043D\u0438\u0446\u0438\u0430\u043B\u0438\u0437\u0438\u0440\u043E\u0432\u0430\u043D\u0430 \u0438\u043B\u0438 \u0438\u043C\u0435\u0435\u0442 \u043D\u0435\u0432\u0435\u0440\u043D\u044B\u0439 \u0444\u043E\u0440\u043C\u0430\u0442")},a.prototype.initFolders=function(a){return!("object"!=typeof a)&&(this.folders=a,this.folders)},a.prototype.setActiveFolder=function(a){if(this.folders[a])return this.label=a,this.folder_id=this.folders[a],this.folder_id;throw new Error("\u041E\u0431\u044A\u0435\u043A\u0442 \u043D\u0435 \u043F\u043E\u0434\u0434\u0435\u0440\u0436\u0438\u0432\u0430\u0435\u0442 \u0440\u0430\u0431\u043E\u0442\u0443 \u0441 \u043F\u0430\u043F\u043A\u043E\u0439 "+a)},a.prototype.addFolder=function(a,b){if(b&&a)return this.folders[a]=b;throw new Error("\u041D\u0435\u0432\u0435\u0440\u043D\u043E \u0437\u0430\u0434\u0430\u043D\u044B \u043F\u0430\u0440\u0430\u043C\u0435\u0442\u0440\u044B \u0444\u0443\u043D\u043A\u0446\u0438\u0438")},a.prototype.deleteFolder=function(a){return delete this.folders[a],this.folders},a.prototype.getFile=function(a,b){this;return $.ajax({type:"GET",url:"https://www.googleapis.com/drive/v2/files/"+b,dataType:"json",data:{fields:"items("+this.config.DRIVE_FILE_INFO+")"},headers:{authorization:"Bearer "+this.token},async:!0,success:a?a:this.success,error:function(){throw new Error("\u041D\u0435 \u0443\u0434\u0430\u043B\u043E\u0441\u044C \u043F\u043E\u043B\u0443\u0447\u0438\u0442\u044C \u0444\u0430\u0439\u043B")}}),!1},a.prototype.getFiles=function(a,b){if(b){let c=this;$.ajax({type:"GET",url:"https://www.googleapis.com/drive/v2/files",dataType:"json",data:{fields:"items("+this.config.DRIVE_FILE_INFO+")",q:"'"+(b?b:this.folder_id)+"' in parents"},headers:{authorization:"Bearer "+this.token},async:!0,success:a?a:this.success,error:function(){throw new Error("\u041D\u0435 \u0443\u0434\u0430\u043B\u043E\u0441\u044C \u043F\u043E\u043B\u0443\u0447\u0438\u0442\u044C \u0441\u043F\u0438\u0441\u043E\u043A \u0444\u0430\u0439\u043B\u043E\u0432 \u0438\u0437 \u043F\u0430\u043F\u043A\u0438 "+c.label)}})}return!1},a.prototype.uploadFile=function(a,b,c){let f,g=this;const h="\r\n--"+this.config.BOUNDARY+"\r\n",i="\r\n--"+this.config.BOUNDARY+"--";let j=new FileReader;j.onloadend=function(j){let k=a.type||"application/octet-stream",l={title:a.name,mimeType:k,parents:[{id:c?c:g.folder_id}]};f=-1===g.getInternetExplorerVersion()?j.target.result:g.IEBinary(j.target.result);let m=btoa(f),n=h+"Content-Type: application/json\r\n\r\n"+JSON.stringify(l)+h+"Content-Type: "+k+"\r\nContent-Transfer-Encoding: base64\r\n\r\n"+m+i,o=0,p=function(){$.ajax({type:"POST",url:"https://content.googleapis.com/upload/drive/v2/files?uploadType=multipart&fields=id,mimeType,description,title,webContentLink",dataType:"json",data:n,processData:!1,headers:{authorization:"Bearer "+g.token,"Content-Type":"multipart/mixed; boundary=\""+g.config.BOUNDARY+"\""},async:!0,error:function(a,b){throw new Error("\u041D\u0435 \u0443\u0434\u0430\u043B\u043E\u0441\u044C \u0437\u0430\u043F\u0438\u0441\u0430\u0442\u044C \u0444\u0430\u0439\u043B. \u041E\u0448\u0438\u0431\u043A\u0430: "+b)},statusCode:{200:b?b:g.success,502:function(){if(2>o)setTimeout(function(){p()},d(1e3*Math.random())),o++;else throw new Error("\u041D\u0435 \u0443\u0434\u0430\u043B\u043E\u0441\u044C \u0437\u0430\u043F\u0438\u0441\u0430\u0442\u044C \u0444\u0430\u0439\u043B. \u041F\u043E\u0432\u0442\u043E\u0440\u0438\u0442\u0435 \u043F\u043E\u0437\u0436\u0435")}}})};p()},-1===g.getInternetExplorerVersion()?j.readAsBinaryString(a):j.readAsArrayBuffer(a)},a.prototype.IEBinary=function(a){let b="",c=new Uint8Array(a),d=c.byteLength;for(let f=0;f<d;f++)b+=String.fromCharCode(c[f]);return b},a.prototype.getChunkRange=function(a,b){return b+this.config.CHUNK_SIZE<a?"bytes "+b+"-"+(b+this.config.CHUNK_SIZE-1)+"/"+a:"bytes "+b+"-"+(a-1)+"/"+a},a.prototype.uploadResumable=function(a,f,g){let h,i,j=function(){let a=0;return function(){return++a}},k=j(),c=this,l=new FileReader,m=JSON.stringify({parents:[{id:g?g:this.folder_id}],title:a.name}),n=a.size,o=0,p=0;$.ajax({type:"POST",url:"https://www.googleapis.com/upload/drive/v2/files?uploadType=resumable",dataType:"json",contentType:"application/json",data:m,processData:!1,headers:{authorization:"Bearer "+c.token,"X-Upload-Content-Type":a.type||"application/octet-stream"},async:!0,statusCode:{200:function(b){if(h=b.getResponseHeader("Location").split("upload_id="),h[1])return h=h[1],p=c.readChunk(l,a,n,o),!1;throw new Error("\u041D\u0435 \u0443\u0434\u0430\u043B\u043E\u0441\u044C \u0437\u0430\u043F\u0438\u0441\u0430\u0442\u044C \u0444\u0430\u0439\u043B. \u041F\u043E\u0432\u0442\u043E\u0440\u0438\u0442\u0435 \u043F\u043E\u0437\u0436\u0435")},502:function(){if(2>k())setTimeout(function(){c.uploadResumable(a,f,g)},d(1e3*Math.random()));else throw j()(),new Error("\u041D\u0435 \u0443\u0434\u0430\u043B\u043E\u0441\u044C \u0437\u0430\u043F\u0438\u0441\u0430\u0442\u044C \u0444\u0430\u0439\u043B. \u041F\u043E\u0432\u0442\u043E\u0440\u0438\u0442\u0435 \u043F\u043E\u0437\u0436\u0435")}}}),l.onloadend=function(g){let j=0,k=0;i=-1===c.getInternetExplorerVersion()?g.target.result:c.IEBinary(g.target.result),$.ajax({type:"PUT",url:"https://www.googleapis.com/upload/drive/v2/files?uploadType=resumable&upload_id="+h,data:btoa(i),contentType:a.type||"application/octet-stream",async:!1,headers:{"Content-Range":c.getChunkRange(a.size,o),"Content-Encoding":"base64"},statusCode:{308:function(){o+=c.config.CHUNK_SIZE,n-=p,p=c.readChunk(l,a,n,o)},503:function(){if(4>j)setTimeout(function(){c.readChunk(l,a,n,o)},1e3*b(2,try_count)+d(1e3*Math.random())),j++;else throw new Error("\u041D\u0435 \u0443\u0434\u0430\u043B\u043E\u0441\u044C \u0437\u0430\u043F\u0438\u0441\u0430\u0442\u044C \u0444\u0430\u0439\u043B. \u041F\u043E\u0432\u0442\u043E\u0440\u0438\u0442\u0435 \u043F\u043E\u0437\u0436\u0435")},502:function(){if(2>k)setTimeout(function(){c.readChunk(l,a,n,o)},d(1e3*Math.random())),k++;else throw new Error("\u041D\u0435 \u0443\u0434\u0430\u043B\u043E\u0441\u044C \u0437\u0430\u043F\u0438\u0441\u0430\u0442\u044C \u0444\u0430\u0439\u043B. \u041F\u043E\u0432\u0442\u043E\u0440\u0438\u0442\u0435 \u043F\u043E\u0437\u0436\u0435")},200:f?f:this.success}})}},a.prototype.readChunk=function(a,b,c,d){let f=c<this.config.CHUNK_SIZE?c:this.config.CHUNK_SIZE,g=b.slice(d,d+f);return-1===this.getInternetExplorerVersion()?a.readAsBinaryString(g):a.readAsArrayBuffer(g),f},a.prototype.updateFile=function(a,b,c){let g=this,h=e.target.files;const f="\r\n--"+this.config.BOUNDARY+"\r\n",i="\r\n--"+this.config.BOUNDARY+"--";for(let j,k=0;j=h[k];k++){let a=j,h=new FileReader;h.onloadend=function(h){let j=a.type||"application/octet-stream",k={title:a.name,mimeType:j,parents:[{id:b}]};-1===g.getInternetExplorerVersion()?h.target.result:g.IEBinary(h.target.result);let l=btoa(h.target.result),m=f+"Content-Type: application/json\r\n\r\n"+JSON.stringify(k)+f+"Content-Type: "+j+"\r\nContent-Transfer-Encoding: base64\r\n\r\n"+l+i,n=0,o=function(){$.ajax({type:"PUT",url:"https://www.googleapis.com/upload/drive/v2/files/"+b+"?uploadType=multipart&fields="+g.config.DRIVE_FILE_INFO,dataType:"json",data:m,processData:!1,headers:{authorization:"Bearer "+g.token,"Content-Type":"multipart/mixed; boundary=\""+g.config.BOUNDARY+"\""},async:!0,error:function(a,b){throw new Error("\u043D\u0435 \u0443\u0434\u0430\u043B\u043E\u0441\u044C \u0438\u0437\u043C\u0435\u043D\u0438\u0442\u044C \u0444\u0430\u0439\u043B. \u041E\u0448\u0438\u0431\u043A\u0430: "+b)},statusCode:{200:c?c:g.success,502:function(){if(2>n)setTimeout(function(){o()},d(1e3*Math.random())),n++;else throw new Error("\u041D\u0435 \u0443\u0434\u0430\u043B\u043E\u0441\u044C \u0437\u0430\u043F\u0438\u0441\u0430\u0442\u044C \u0444\u0430\u0439\u043B. \u041F\u043E\u0432\u0442\u043E\u0440\u0438\u0442\u0435 \u043F\u043E\u0437\u0436\u0435")}}})};o()},-1===g.getInternetExplorerVersion()?h.readAsBinaryString(j):h.readAsArrayBuffer(j)}},a.prototype.updateResumable=function(a,c,f){let g,h,i=this,j=new FileReader,k=JSON.stringify({title:a.name}),l=0,m=a.size,n=0,o=0;$.ajax({type:"POST",url:"https://www.googleapis.com/upload/drive/v2/files/"+c+"?uploadType=resumable",dataType:"json",contentType:"application/json",data:k,processData:!1,headers:{authorization:"Bearer "+i.token,"X-Upload-Content-Type":a.type},async:!0,complete:function(b){if(200===b.status){if(g=b.getResponseHeader("Location").split("upload_id="),g[1])return g=g[1],o=i.readChunk(j,a,m,n),!1;throw new Error("\u041D\u0435 \u0443\u0434\u0430\u043B\u043E\u0441\u044C \u0437\u0430\u043F\u0438\u0441\u0430\u0442\u044C \u0444\u0430\u0439\u043B. \u041F\u043E\u0432\u0442\u043E\u0440\u0438\u0442\u0435 \u043F\u043E\u0437\u0436\u0435")}}}),j.onloadend=function(c){h=-1===i.getInternetExplorerVersion()?c.target.result:i.IEBinary(c.target.result),$.ajax({type:"PUT",url:"https://www.googleapis.com/upload/drive/v2/files?uploadType=resumable&upload_id="+g,data:btoa(h),contentType:a.type,async:!1,headers:{"Content-Range":i.getChunkRange(a.size,n),"Content-Encoding":"base64"},statusCode:{308:function(){n+=i.config.CHUNK_SIZE,m-=o,o=i.readChunk(j,a,m,n)},503:function(){if(4>l)setTimeout(function(){i.readChunk(j,a,m,n)},1e3*b(2,l)+d(1e3*Math.random())),l++;else throw new Error("\u041D\u0435 \u0443\u0434\u0430\u043B\u043E\u0441\u044C \u0437\u0430\u043F\u0438\u0441\u0430\u0442\u044C \u0444\u0430\u0439\u043B. \u041F\u043E\u0432\u0442\u043E\u0440\u0438\u0442\u0435 \u043F\u043E\u0437\u0436\u0435")}},success:f?f:i.success})}},a.prototype.createFolder=function(a){let b=this,c=0,f=function(){$.ajax({type:"POST",url:"https://www.googleapis.com/drive/v2/files?fields=id",dataType:"json",data:JSON.stringify({title:Date.now(),parents:[{id:b.folder_id}],mimeType:"application/vnd.google-apps.folder"}),processData:!1,headers:{authorization:"Bearer "+b.token,"Content-Type":"application/json"},async:!0,error:function(a,b){throw new Error("\u041D\u0435 \u0443\u0434\u0430\u043B\u043E\u0441\u044C \u0441\u043E\u0437\u0434\u0430\u0442\u044C \u0434\u0438\u0440\u0435\u043A\u0442\u043E\u0440\u0438\u044E. \u041E\u0448\u0438\u0431\u043A\u0430: "+b)},statusCode:{200:a?a:b.success,502:function(){if(2>c)setTimeout(function(){f()},d(1e3*Math.random())),c++;else throw new Error("\u041D\u0435 \u0443\u0434\u0430\u043B\u043E\u0441\u044C \u0437\u0430\u043F\u0438\u0441\u0430\u0442\u044C \u0444\u0430\u0439\u043B. \u041F\u043E\u0432\u0442\u043E\u0440\u0438\u0442\u0435 \u043F\u043E\u0437\u0436\u0435")}}})};f()},a.prototype.delete=function(a,b){this;$.ajax({type:"DELETE",url:"https://www.googleapis.com/drive/v2/files/"+a,dataType:"json",headers:{authorization:"Bearer "+this.token,"Content-Type":"application/json"},async:!0,success:b?b:this.success,error:function(a,b){throw new Error("\u041D\u0435 \u0443\u0434\u0430\u043B\u043E\u0441\u044C \u0443\u0434\u0430\u043B\u0438\u0442\u044C \u0444\u0430\u0439\u043B \u0438\u043B\u0438 \u0434\u0438\u0440\u0435\u043A\u0442\u043E\u0440\u0438\u044E. \u041E\u0448\u0438\u0431\u043A\u0430: "+b)}})},a.prototype.getInternetExplorerVersion=function(){let a=-1;if("Microsoft Internet Explorer"===navigator.appName){let b=navigator.userAgent,c=/MSIE ([0-9]{1,}[.0-9]{0,})/;null!==c.exec(b)&&(a=parseFloat(RegExp.$1))}else if("Netscape"===navigator.appName){let b=navigator.userAgent,c=/Trident\/.*rv:([0-9]{1,}[.0-9]{0,})/;null!==c.exec(b)&&(a=parseFloat(RegExp.$1))}return a},a.prototype.setToken=function(){if(!this.token){let a=this;return $.ajax({async:!1,url:this.config.SERVER_URL,success:function(b){if(77===b.length)a.token=b;else throw new Error("\u041F\u043E\u043B\u0443\u0447\u0435\u043D \u043D\u0435\u0432\u0435\u0440\u043D\u044B\u0439 \u0442\u043E\u043A\u0435\u043D \u043E\u0442 \u0441\u0435\u0440\u0432\u0435\u0440\u0430")},error:function(){throw new Error("\u041F\u043E\u043B\u0443\u0447\u0435\u043D \u043D\u0435\u0432\u0435\u0440\u043D\u044B\u0439 \u0442\u043E\u043A\u0435\u043D \u043E\u0442 \u0441\u0435\u0440\u0432\u0435\u0440\u0430")}}),!0}return!1},a.prototype.deleteToken=function(){this.token=!1}});

